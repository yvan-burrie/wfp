/*
 * jQuery Address Plugin v1.6
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: 2012-11-18 23:51:44 +0200 (Sun, 18 Nov 2012)
 */
/*! jQuery Address v${version} | (c) 2009, 2013 Rostislav Hristov | jquery.org/license */
!function(t){t.address=function(){var e,r,n,a=function(e){var r=t.extend(t.Event(e),function(){for(var e={},r=t.address.parameterNames(),n=0,a=r.length;n<a;n++)e[r[n]]=t.address.parameter(r[n]);return{value:t.address.value(),path:t.address.path(),pathNames:t.address.pathNames(),parameterNames:r,parameters:e,queryString:t.address.queryString()}}.call(t.address));return t(t.address).trigger(r),r},i=function(t){return Array.prototype.slice.call(t)},s=function(e,r,n){return t().bind.apply(t(t.address),Array.prototype.slice.call(arguments)),t.address},o=function(){return L.pushState&&void 0!==T.state},c=function(){return("/"+C.pathname.replace(new RegExp(T.state),"")+C.search+(d()?"#"+d():"")).replace(_,"/")},d=function(){var t=C.href.indexOf("#");return-1!=t?C.href.substr(t+1):""},u=function(){return o()?c():d()},l=function(){try{return void 0!==top.document&&void 0!==top.document.title&&void 0!==top.jQuery&&void 0!==top.jQuery.address&&!1!==top.jQuery.address.frames()?top:window}catch(t){return window}},p=function(t){return t=t.toString(),(T.strict&&"/"!=t.substr(0,1)?"/":"")+t},h=function(t,e){return parseInt(t.css(e),10)},f=function(){if(!K){var t=u();decodeURI(V)!=decodeURI(t)&&($&&q<7?C.reload():($&&!B&&T.history&&W(m,50),V=t,v(R)))}},v=function(t){return W(g,10),a(S).isDefaultPrevented()||a(t?j:I).isDefaultPrevented()},g=function(){if("null"!==T.tracker&&T.tracker!==b){var e=t.isFunction(T.tracker)?T.tracker:O[T.tracker],r=(C.pathname+C.search+(t.address&&!o()?t.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");t.isFunction(e)?e(r):(t.isFunction(O.urchinTracker)&&O.urchinTracker(r),void 0!==O.pageTracker&&t.isFunction(O.pageTracker._trackPageview)&&O.pageTracker._trackPageview(r),void 0!==O._gaq&&t.isFunction(O._gaq.push)&&O._gaq.push(["_trackPageview",decodeURI(r)]),t.isFunction(O.ga)&&O.ga("send","pageview",r))}},m=function(){var t="javascript:"+R+";document.open();document.writeln('<html><head><title>"+F.title.replace(/\'/g,"\\'")+"</title><script>var "+x+' = "'+encodeURIComponent(u()).replace(/\'/g,"\\'")+(F.domain!=C.hostname?'";document.domain="'+F.domain:"")+"\";<\/script></head></html>');document.close();";q<7?e.src=t:e.contentWindow.location.replace(t)},y=function(){if(P&&-1!=Q){var t,e,r=P.substr(Q+1).split("&");for(t=0;t<r.length;t++)e=r[t].split("="),/^(autoUpdate|history|strict|wrap)$/.test(e[0])&&(T[e[0]]=isNaN(e[1])?/^(true|yes)$/i.test(e[1]):0!==parseInt(e[1],10)),/^(state|tracker)$/.test(e[0])&&(T[e[0]]=e[1]);P=b}V=u()},w=function(){if(!G){if(G=U,y(),t('a[rel*="address:"]').address(),T.wrap){var r=t("body");t("body > *").wrapAll('<div style="padding:'+(h(r,"marginTop")+h(r,"paddingTop"))+"px "+(h(r,"marginRight")+h(r,"paddingRight"))+"px "+(h(r,"marginBottom")+h(r,"paddingBottom"))+"px "+(h(r,"marginLeft")+h(r,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+x+'" style="height:100%;overflow:auto;position:relative;'+(N&&!window.statusbar.visible?"resize:both;":"")+'" />');t("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),N&&t('<style type="text/css" />').appendTo("head").text("#"+x+"::-webkit-resizer { background-color: #fff; }")}if($&&!B){var n=F.getElementsByTagName("frameset")[0];(e=F.createElement((n?"":"i")+"frame")).src="javascript:"+R,n?(n.insertAdjacentElement("beforeEnd",e),n[n.cols?"cols":"rows"]+=",0",e.noResize=U,e.frameBorder=e.frameSpacing=0):(e.style.display="none",e.style.width=e.style.height=0,e.tabIndex=-1,F.body.insertAdjacentElement("afterBegin",e)),W(function(){t(e).bind("load",function(){var t=e.contentWindow;(V=void 0!==t[x]?t[x]:"")!=u()&&(v(R),C.hash=V)}),void 0===e.contentWindow[x]&&m()},50)}W(function(){a("init"),v(R)},1),o()||($&&q>7||!$&&B?O.addEventListener?O.addEventListener(k,f,R):O.attachEvent&&O.attachEvent("on"+k,f):M(f,50)),"state"in window.history&&t(window).trigger("popstate")}},b=null,x="jQueryAddress",k="hashchange",E="init",S="change",j="internalChange",I="externalChange",U=!0,R=!1,T={autoUpdate:U,history:U,strict:U,frames:U,wrap:R},A=(r={},(n=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(navigator.userAgent)).browser&&(r[n.browser]=!0,r.version=n.version),r.chrome?r.webkit=!0:r.webkit&&(r.safari=!0),r),q=parseFloat(A.version),N=A.webkit||A.safari,$=A.msie,O=l(),F=O.document,L=O.history,C=O.location,M=setInterval,W=setTimeout,_=/\/{2,9}/g,z=navigator.userAgent,B="on"+k in O,P=t("script:last").attr("src"),Q=P?P.indexOf("?"):-1,D=F.title,K=R,G=R,H=U,J=R,V=u();if($){q=parseFloat(z.substr(z.indexOf("MSIE")+4)),F.documentMode&&F.documentMode!=q&&(q=8!=F.documentMode?7:8);var X=F.onpropertychange;F.onpropertychange=function(){X&&X.call(F),F.title!=D&&-1!=F.title.indexOf("#"+u())&&(F.title=D)}}if(L.navigationMode&&(L.navigationMode="compatible"),"complete"==document.readyState)var Y=setInterval(function(){t.address&&(w(),clearInterval(Y))},50);else y(),t(w);return t(window).bind("popstate",function(){decodeURI(V)!=decodeURI(u())&&(V=u(),v(R))}).bind("unload",function(){O.removeEventListener?O.removeEventListener(k,f,R):O.detachEvent&&O.detachEvent("on"+k,f)}),{bind:function(t,e,r){return s.apply(this,i(arguments))},unbind:function(e,r){return function(e,r){return t().unbind.apply(t(t.address),Array.prototype.slice.call(arguments)),t.address}.apply(this,i(arguments))},init:function(t,e){return s.apply(this,[E].concat(i(arguments)))},change:function(t,e){return s.apply(this,[S].concat(i(arguments)))},internalChange:function(t,e){return s.apply(this,[j].concat(i(arguments)))},externalChange:function(t,e){return s.apply(this,[I].concat(i(arguments)))},baseURL:function(){var t=C.href;return-1!=t.indexOf("#")&&(t=t.substr(0,t.indexOf("#"))),/\/$/.test(t)&&(t=t.substr(0,t.length-1)),t},autoUpdate:function(t){return void 0!==t?(T.autoUpdate=t,this):T.autoUpdate},history:function(t){return void 0!==t?(T.history=t,this):T.history},state:function(t){if(void 0!==t){T.state=t;var e=c();return void 0!==T.state&&(L.pushState?"/#/"==e.substr(0,3)&&C.replace(T.state.replace(/^\/$/,"")+e.substr(2)):"/"!=e&&e.replace(/^\/#/,"")!=d()&&W(function(){C.replace(T.state.replace(/^\/$/,"")+"/#"+e)},1)),this}return T.state},frames:function(t){return void 0!==t?(T.frames=t,O=l(),this):T.frames},strict:function(t){return void 0!==t?(T.strict=t,this):T.strict},tracker:function(t){return void 0!==t?(T.tracker=t,this):T.tracker},wrap:function(t){return void 0!==t?(T.wrap=t,this):T.wrap},update:function(){return J=U,this.value(V),J=R,this},title:function(t){return void 0!==t?(W(function(){D=F.title=t,H&&e&&e.contentWindow&&e.contentWindow.document&&(e.contentWindow.document.title=t,H=R)},50),this):F.title},value:function(t){if(void 0!==t){if("/"==(t=p(t))&&(t=""),V==t&&!J)return;if(V=t,T.autoUpdate||J){if(v(U))return this;o()?L[T.history?"pushState":"replaceState"]({},"",T.state.replace(/\/$/,"")+(""===V?"/":V)):(K=U,N?T.history?C.hash="#"+V:C.replace("#"+V):V!=u()&&(T.history?C.hash="#"+V:C.replace("#"+V)),$&&!B&&T.history&&W(m,50),N?W(function(){K=R},1):K=R)}return this}return p(V)},path:function(t){if(void 0!==t){var e=this.queryString(),r=this.hash();return this.value(t+(e?"?"+e:"")+(r?"#"+r:"")),this}return p(V).split("#")[0].split("?")[0]},pathNames:function(){var t=this.path(),e=t.replace(_,"/").split("/");return"/"!=t.substr(0,1)&&0!==t.length||e.splice(0,1),"/"==t.substr(t.length-1,1)&&e.splice(e.length-1,1),e},queryString:function(t){if(void 0!==t){var e=this.hash();return this.value(this.path()+(t?"?"+t:"")+(e?"#"+e:"")),this}var r=V.split("?");return r.slice(1,r.length).join("?").split("#")[0]},parameter:function(e,r,n){var a,i;if(void 0!==r){var s=this.parameterNames();for(i=[],r=void 0===r||r===b?"":r.toString(),a=0;a<s.length;a++){var o=s[a],c=this.parameter(o);"string"==typeof c&&(c=[c]),o==e&&(c=r===b||""===r?[]:n?c.concat([r]):[r]);for(var d=0;d<c.length;d++)i.push(o+"="+c[d])}return-1==t.inArray(e,s)&&r!==b&&""!==r&&i.push(e+"="+r),this.queryString(i.join("&")),this}if(r=this.queryString()){var u=[];for(i=r.split("&"),a=0;a<i.length;a++){var l=i[a].split("=");l[0]==e&&u.push(l.slice(1).join("="))}if(0!==u.length)return 1!=u.length?u:u[0]}},parameterNames:function(){var e=this.queryString(),r=[];if(e&&-1!=e.indexOf("="))for(var n=e.split("&"),a=0;a<n.length;a++){var i=n[a].split("=")[0];-1==t.inArray(i,r)&&r.push(i)}return r},hash:function(t){if(void 0!==t)return this.value(V.split("#")[0]+(t?"#"+t:"")),this;var e=V.split("#");return e.slice(1,e.length).join("#")}}}(),t.fn.address=function(e){return t(this).each(function(r){t(this).data("address")||t(this).on("click",function(r){if(r.shiftKey||r.ctrlKey||r.metaKey||2==r.which)return!0;var n=r.currentTarget;if(t(n).is("a")){r.preventDefault();var a=e?e.call(n):/address:/.test(t(n).attr("rel"))?t(n).attr("rel").split("address:")[1].split(" ")[0]:void 0===t.address.state()||/^\/?$/.test(t.address.state())?t(n).attr("href").replace(/^(#\!?|\.)/,""):t(n).attr("href").replace(new RegExp("^(.*"+t.address.state()+"|\\.)"),"");t.address.value(a)}}).on("submit",function(r){var n=r.currentTarget;if(t(n).is("form")){r.preventDefault();var a=t(n).attr("action"),i=e?e.call(n):(-1!=a.indexOf("?")?a.replace(/&$/,""):a+"?")+t(n).serialize();t.address.value(i)}}).data("address",!0)}),this}}(jQuery);